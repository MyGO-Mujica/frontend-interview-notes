

# DOM æ“ä½œä¸ä¼˜åŒ– 

## ğŸ“Œ æ ¸å¿ƒæ¦‚å¿µ

DOMï¼ˆDocument Object Modelï¼Œæ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼‰æ˜¯ HTML å’Œ XML æ–‡æ¡£çš„ç¼–ç¨‹æ¥å£ã€‚å®ƒå°†æ–‡æ¡£è¡¨ç¤ºä¸ºèŠ‚ç‚¹æ ‘ï¼Œå…è®¸ JavaScript è®¿é—®å’Œæ“ä½œé¡µé¢å†…å®¹ã€ç»“æ„å’Œæ ·å¼ã€‚

**æ ¸å¿ƒè¦ç‚¹ï¼š**

- DOM æ˜¯æµè§ˆå™¨æä¾›çš„ APIï¼Œç”¨äºæ“ä½œç½‘é¡µå…ƒç´ 
- DOM æ“ä½œä¼šè§¦å‘æµè§ˆå™¨çš„é‡æ’ï¼ˆReflowï¼‰å’Œé‡ç»˜ï¼ˆRepaintï¼‰
- é¢‘ç¹çš„ DOM æ“ä½œä¼šå½±å“æ€§èƒ½ï¼Œéœ€è¦ä¼˜åŒ–
- ç°ä»£å‰ç«¯æ¡†æ¶ï¼ˆVue/Reactï¼‰éƒ½æ˜¯ä¸ºäº†ä¼˜åŒ– DOM æ“ä½œè€Œç”Ÿ



## **å¸¸è§é¢è¯•é—®é¢˜**

### 1.  ç»Ÿè®¡å½“å‰é¡µé¢å‡ºç°æ¬¡æ•°æœ€å¤šçš„æ ‡ç­¾

***é—®é¢˜***ï¼šå¦‚ä½•ç»Ÿè®¡å½“å‰é¡µé¢ä¸­å‡ºç°æ¬¡æ•°æœ€å¤šçš„ HTML æ ‡ç­¾ï¼Ÿ 



**æ¨èå›ç­”æ€è·¯ï¼š**

\- ä½¿ç”¨ `document.querySelectorAll('*')` è·å–æ‰€æœ‰å…ƒç´ 

\- éå†å…ƒç´ ç»Ÿè®¡æ¯ä¸ªæ ‡ç­¾åå‡ºç°çš„æ¬¡æ•°

\- æ‰¾å‡ºå‡ºç°æ¬¡æ•°æœ€å¤šçš„æ ‡ç­¾



```javascript
function getMostFrequentTag() {
  const tags = document.querySelectorAll('*');
  const tagCount = {};
  
  // ç»Ÿè®¡æ¯ä¸ªæ ‡ç­¾å‡ºç°æ¬¡æ•°
  tags.forEach(tag => {
    const tagName = tag.tagName.toLowerCase();
    tagCount[tagName] = (tagCount[tagName] || 0) + 1;
  });
  
  // æ‰¾å‡ºå‡ºç°æ¬¡æ•°æœ€å¤šçš„æ ‡ç­¾
  let maxTag = '';
  let maxCount = 0;
  
  for (let tag in tagCount) {
    if (tagCount[tag] > maxCount) {
      maxCount = tagCount[tag];
      maxTag = tag;
    }
  }
  
  return { tag: maxTag, count: maxCount };
}
```



### 2. ä»€ä¹ˆæ˜¯è·¨åŸŸï¼Œå¦‚ä½•è§£å†³ä»€ä¹ˆæ˜¯è·¨åŸŸï¼Ÿ

**æ ¸å¿ƒæ¦‚å¿µ**

è·¨åŸŸæ˜¯ç”±äºæµè§ˆå™¨çš„***\*åŒæºç­–ç•¥\****ï¼ˆSame-Origin Policyï¼‰å¯¼è‡´çš„å®‰å…¨é™åˆ¶ã€‚å½“åè®®ï¼ˆprotocolï¼‰ã€åŸŸåï¼ˆdomainï¼‰æˆ–ç«¯å£ï¼ˆportï¼‰ä»»ä¸€ä¸åŒæ—¶ï¼Œå°±ä¼šäº§ç”Ÿè·¨åŸŸé—®é¢˜ã€‚

1. **æ–¹æ¡ˆ1ï¼šCORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰** â­ æœ€å¸¸ç”¨

   **åŸç†**ï¼šæœåŠ¡å™¨è®¾ç½®å“åº”å¤´å…è®¸è·¨åŸŸ

2. **æ–¹æ¡ˆ2ï¼šJSONP**

â€‹	  **åŸç†**ï¼šåˆ©ç”¨ `<script>` æ ‡ç­¾ä¸å—åŒæºç­–ç•¥é™åˆ¶çš„ç‰¹æ€§

â€‹	  **ç¼ºç‚¹**ï¼šåªæ”¯æŒ GET è¯·æ±‚ï¼Œå­˜åœ¨å®‰å…¨é£é™© **é€‚ç”¨åœºæ™¯**ï¼šè€é¡¹ç›®æˆ–åªéœ€è¦ GET è¯·æ±‚çš„åœºæ™¯

3. **æ–¹æ¡ˆ3ï¼šä»£ç†æœåŠ¡å™¨**

â€‹    \- **å¼€å‘ç¯å¢ƒï¼š**webpack devServer æˆ– Vite ä»£ç†

â€‹    \- **ç”Ÿäº§ç¯å¢ƒï¼š**Nginx åå‘ä»£ç†



**æ¨èå›ç­”ç»“æ„**ï¼š

> "è·¨åŸŸæ˜¯ç”±äºæµè§ˆå™¨çš„åŒæºç­–ç•¥å¯¼è‡´çš„ï¼Œå½“åè®®ã€åŸŸåæˆ–ç«¯å£ä»»ä¸€ä¸åŒæ—¶å°±ä¼šäº§ç”Ÿè·¨åŸŸé—®é¢˜ã€‚
>
> **æœ€å¸¸ç”¨çš„è§£å†³æ–¹æ¡ˆæ˜¯ CORS**ï¼Œç”±æœåŠ¡å™¨è®¾ç½® `Access-Control-Allow-Origin` ç­‰å“åº”å¤´æ¥å…è®¸è·¨åŸŸã€‚
>
> **å¼€å‘ç¯å¢ƒä¸­**ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨ webpack çš„ devServer ä»£ç†æˆ– Nginx åå‘ä»£ç†æ¥è§£å†³ã€‚
>
> **å…¶ä»–æ–¹æ¡ˆ**è¿˜åŒ…æ‹¬ JSONPï¼ˆåªæ”¯æŒ GETï¼‰ã€WebSocket ç­‰ï¼Œå…·ä½“é€‰æ‹©å“ªç§æ–¹æ¡ˆè¦æ ¹æ®å®é™…ä¸šåŠ¡åœºæ™¯å†³å®šã€‚"



### 3. ç½‘ç«™å¼€å‘ä¸­ï¼Œå¦‚ä½•å®ç°å›¾ç‰‡çš„æ‡’åŠ è½½

**1. æ ¸å¿ƒåŸç†ï¼š** å®ƒçš„æ ¸å¿ƒæ˜¯ **â€œå»¶è¿ŸåŠ è½½â€**ã€‚é¡µé¢åŠ è½½æ—¶ï¼Œå…ˆä¸åŠ è½½è§†å£ï¼ˆViewportï¼‰ä¹‹å¤–çš„å›¾ç‰‡ï¼ŒåªåŠ è½½å¯è§†åŒºåŸŸå†…çš„ã€‚å½“ç”¨æˆ·æ»šåŠ¨é¡µé¢ï¼Œå›¾ç‰‡å³å°†è¿›å…¥è§†å£æ—¶ï¼Œæ‰å»è§¦å‘åŠ è½½ã€‚

**2. ä¸ºä»€ä¹ˆç”¨ï¼š** ä¸»è¦ç›®çš„æ˜¯**æå‡é¦–å±åŠ è½½é€Ÿåº¦**ï¼Œå‡å°‘é¦–æ¬¡åŠ è½½æ—¶ä¸å¿…è¦çš„HTTPè¯·æ±‚ï¼ŒåŒæ—¶**èŠ‚çœç”¨æˆ·æµé‡**ã€‚

**3. å¦‚ä½•å®ç°ï¼ˆä¸¤ç§ä¸»æµæ–¹å¼ï¼‰ï¼š**

- **æ–¹å¼ä¸€ï¼š`IntersectionObserver` (äº¤å‰è§‚å¯Ÿå™¨) - ï¼ˆç›®å‰æ¨èï¼‰** è¿™æ˜¯ç›®å‰**æ€§èƒ½æœ€å¥½ã€æœ€ä¸»æµ**çš„æ–¹å¼ã€‚

```javascript
const observer = new IntersectionObserver((changes) => {
  changes.forEach((change) => {
    // intersectionRatio
    if (change.isIntersecting) {
      const img = change.target
      img.src = img.dataset.src
      observer.unobserve(img)
    }
  })
})
 
observer.observe(img)
```

â€‹      1. å…ˆæŠŠå›¾ç‰‡çœŸå®åœ°å€å­˜åœ¨`data-src`å±æ€§ä¸Šã€‚`<img data-src="çœŸå®å›¾ç‰‡åœ°å€">`

â€‹      2. æˆ‘ä»¬ç”¨`IntersectionObserver`å»â€˜è§‚å¯Ÿâ€™è¿™ä¸ªå›¾ç‰‡ã€‚

â€‹      3. å½“APIç›‘å¬åˆ°å›¾ç‰‡è¿›å…¥è§†å£æ—¶ï¼Œæˆ‘ä»¬å†æŠŠ`data-src`çš„å€¼èµ‹ç»™`src`å±æ€§ï¼Œå›¾ç‰‡å°±åŠ è½½äº†ã€‚`img.src = img.dataset.src`

â€‹	  4. å®ƒæ¯”ä»¥å‰ç›‘å¬`scroll`äº‹ä»¶æ€§èƒ½å¥½å¾—å¤šï¼Œä¸ä¼šå¼•å‘å¡é¡¿ã€‚

- **æ–¹å¼äºŒï¼š`loading="lazy"` (æµè§ˆå™¨åŸç”Ÿ) - ï¼ˆæœ€ç®€å•ï¼‰** å¦‚æœä¸éœ€è¦å…¼å®¹è€æ—§æµè§ˆå™¨ï¼Œè¿™æ˜¯**æœ€ç®€å•**çš„æ–¹å¼ã€‚



### 4. sessionStorageä¸localStorageæœ‰ä½•åŒºåˆ«

 **æ¨èå›ç­”ç»“æ„**ï¼š

> localStorageç”Ÿå‘½å‘¨æœŸæ˜¯æ°¸ä¹…é™¤éè‡ªä¸»æ¸…é™¤ sessionStorageç”Ÿå‘½å‘¨æœŸä¸ºå½“å‰çª—å£æˆ–æ ‡ç­¾é¡µï¼Œå…³é—­çª—å£æˆ–æ ‡ç­¾é¡µåˆ™ä¼šæ¸…é™¤æ•°æ®
>
> ä»–ä»¬å‡åªèƒ½å­˜å‚¨å­—ç¬¦ä¸²ç±»å‹çš„å¯¹è±¡
>
> ä¸åŒæµè§ˆå™¨æ— æ³•å…±äº«localStorageæˆ–sessionStorageä¸­çš„ä¿¡æ¯ã€‚ç›¸åŒæµè§ˆå™¨çš„ä¸åŒé¡µé¢é—´å¯ä»¥å…±äº«ç›¸åŒçš„ localStorageï¼ˆé¡µé¢å±äºç›¸åŒåŸŸåå’Œç«¯å£ï¼‰ï¼Œä½†æ˜¯ä¸åŒé¡µé¢æˆ–æ ‡ç­¾é¡µé—´æ— æ³•å…±äº«sessionStorageçš„ä¿¡æ¯ã€‚



### 5.å¦‚ä½•å°è£…ä¸€ä¸ªæ”¯æŒè¿‡æœŸæ—¶é—´çš„ localStorage

**æ ¸å¿ƒçŸ¥è¯†ç‚¹**

é€šè¿‡å°è£…åŸç”Ÿ `localStorage` æ–¹æ³•ï¼Œå®ç°å¯¹å­˜å‚¨æ•°æ®**è®¾ç½®æ—¶é—´æˆ³**å’Œåœ¨**è¯»å–æ—¶è¿›è¡Œæ ¡éªŒ**çš„æ ¸å¿ƒé€»è¾‘ã€‚

- **æ•°æ®ç»“æ„è®¾è®¡ï¼š** å­˜å‚¨çš„å€¼ä¸åº”è¯¥æ˜¯åŸå§‹å€¼ï¼Œè€Œæ˜¯ä¸€ä¸ªåŒ…å«åŸå§‹æ•°æ®å’Œè¿‡æœŸæ—¶é—´æˆ³ï¼ˆ`expires`ï¼‰çš„**å¯¹è±¡**ã€‚
  - `value`: å®é™…éœ€è¦å­˜å‚¨çš„æ•°æ®ã€‚
  - `expires`: æ•°æ®çš„è¿‡æœŸæ—¶é—´ç‚¹ï¼Œé€šå¸¸æ˜¯å½“å‰æ—¶é—´åŠ ä¸Šæœ‰æ•ˆæœŸï¼ˆæ¯«ç§’æ•°ï¼‰ã€‚
- **å­˜å‚¨ï¼ˆ`setItem` å°è£…ï¼‰ï¼š** å­˜å‚¨æ—¶ï¼Œå°†åŸå§‹å€¼å’Œè®¡ç®—å‡ºçš„è¿‡æœŸæ—¶é—´ä¸€èµ·å°è£…æˆä¸€ä¸ªå¯¹è±¡ï¼Œç„¶åç”¨ `JSON.stringify()` å­˜å…¥ `localStorage`ã€‚
- **è¯»å–ï¼ˆ`getItem` å°è£…ï¼‰ï¼š**
  1. ä» `localStorage` å–å‡ºå­˜å‚¨çš„å­—ç¬¦ä¸²ï¼Œå¹¶ç”¨ `JSON.parse()` è§£æå›å¯¹è±¡ã€‚
  2. **æ ¸å¿ƒåˆ¤æ–­ï¼š** æ£€æŸ¥å½“å‰æ—¶é—´æ˜¯å¦å¤§äºå­˜å‚¨çš„è¿‡æœŸæ—¶é—´æˆ³ (`expires`)ã€‚
  3. å¦‚æœ**å·²è¿‡æœŸ**ï¼Œè°ƒç”¨ `removeItem` æ¸…é™¤è¯¥é¡¹ï¼Œå¹¶è¿”å› `null`ã€‚
  4. å¦‚æœ**æœªè¿‡æœŸ**ï¼Œè¿”å›å¯¹è±¡ä¸­çš„å®é™…æ•°æ® (`value`)ã€‚

```javascript
(function () {

    localStorage.setItem = function (key, value, time = Infinity) {
        
        // æ£€æŸ¥ä¼ å…¥çš„ time æ˜¯å¦æ˜¯æœ‰é™æ•°å­—ï¼ˆå³æ˜¯å¦è®¾ç½®äº†æ˜ç¡®çš„è¿‡æœŸæ—¶é—´ï¼‰ã€‚
        const payload = Number.isFinite(time)
            ? {
                  // å¦‚æœè®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œå°†æ•°æ®å’Œè¿‡æœŸæ—¶é—´å°è£…æˆä¸€ä¸ªå¯¹è±¡ã€‚
                  __data: value, // å­˜å‚¨å®é™…æ•°æ®
                  // è®¡ç®—æ•°æ®åœ¨æœªæ¥çš„è¿‡æœŸæ—¶é—´ç‚¹ï¼ˆå½“å‰æ—¶é—´ + æœ‰æ•ˆæœŸæ¯«ç§’æ•°ï¼‰
                  __expiresTime: Date.now() + time, 
              }
            : value; // å¦‚æœ time æ˜¯ Infinityï¼Œåˆ™ payload å°±æ˜¯åŸå§‹å€¼ï¼Œä¸æ·»åŠ è¿‡æœŸæ ‡è®°ã€‚

        // è°ƒç”¨åŸç”Ÿ Storage.prototype.setItem æ–¹æ³•æ¥æ‰§è¡Œå®é™…çš„å­˜å‚¨æ“ä½œã€‚
        // ä½¿ç”¨ .call(localStorage, ...) ç¡®ä¿æ–¹æ³•åœ¨ localStorage å®ä¾‹çš„ä¸Šä¸‹æ–‡ä¸Šæ‰§è¡Œã€‚
        // æ³¨æ„ï¼šæ— è®ºæ˜¯å°è£…çš„å¯¹è±¡è¿˜æ˜¯åŸå§‹å€¼ï¼Œéƒ½å¿…é¡»å…ˆç”¨ JSON.stringify() è½¬æ¢ä¸ºå­—ç¬¦ä¸²æ‰èƒ½å­˜å‚¨ã€‚
        Storage.prototype.setItem.call(localStorage, key, JSON.stringify(payload));
    };

    /**
     * é‡å†™ localStorage.getItem æ–¹æ³•ï¼Œä½¿å…¶åœ¨è¯»å–æ—¶èƒ½è¿›è¡Œè¿‡æœŸæ ¡éªŒã€‚
     * @param {string} key é”®å
     * @returns {string | undefined} æœªè¿‡æœŸåˆ™è¿”å› JSON å­—ç¬¦ä¸²å½¢å¼çš„å®é™…æ•°æ®ï¼Œå¦åˆ™è¿”å› undefinedã€‚
     */
    localStorage.getItem = function (key) {
        
        // è°ƒç”¨åŸç”Ÿ Storage.prototype.getItem æ–¹æ³•è·å–å­˜å‚¨çš„å­—ç¬¦ä¸²ã€‚
        const value = Storage.prototype.getItem.call(localStorage, key);
        
        // å¦‚æœæœªå–åˆ°å€¼ï¼ˆnullï¼‰ï¼Œç›´æ¥è¿”å›ï¼Œä¸åšåç»­å¤„ç†ã€‚
        if (value === null) {
            return null;
        }

        try {
            // å°è¯•è§£æå–å‡ºçš„å­—ç¬¦ä¸²ï¼Œçœ‹å®ƒæ˜¯å¦æ˜¯æˆ‘ä»¬å°è£…çš„ JSON å¯¹è±¡ã€‚
            const jsonVal = JSON.parse(value);
            
            // æ£€æŸ¥è§£æåçš„å¯¹è±¡ä¸­æ˜¯å¦å­˜åœ¨ __expiresTime å±æ€§ã€‚
            if (jsonVal && jsonVal.__expiresTime) {
                // å¦‚æœå­˜åœ¨è¿‡æœŸæ—¶é—´æ ‡è®°ï¼Œåˆ™è¿›è¡Œè¿‡æœŸæ ¡éªŒï¼š
                
                // æ ¡éªŒï¼šè¿‡æœŸæ—¶é—´ç‚¹ >= å½“å‰æ—¶é—´ï¼Œå³æ•°æ®æœªè¿‡æœŸã€‚
                return jsonVal.__expiresTime >= Date.now()
                    // æœªè¿‡æœŸï¼šè¿”å›å®é™…å­˜å‚¨çš„æ•°æ® __data (JSON.stringify æ˜¯å› ä¸ºåŸæ¥çš„ value æ˜¯ stringified)
                    ? JSON.stringify(jsonVal.__data)
                    // å·²è¿‡æœŸï¼šè¿”å› undefined (void 0 æ˜¯ä¸€ä¸ªè¿”å› undefined çš„ç®€æ´å†™æ³•)
                    : void 0;
            }
            
            // å¦‚æœè§£ææˆåŠŸï¼Œä½†æ²¡æœ‰ __expiresTime æ ‡è®°ï¼Œè¯´æ˜å®ƒæ˜¯ä¸€ä¸ªæ°¸ä¸è¿‡æœŸçš„åŸå§‹å­˜å‚¨é¡¹ï¼Œç›´æ¥è¿”å›ã€‚
            return value; 

        } catch (error) {
            // å¦‚æœ JSON.parse å¤±è´¥ï¼Œè¯´æ˜å­˜å‚¨çš„æ˜¯ä¸€ä¸ªåŸå§‹å­—ç¬¦ä¸²ï¼ˆé JSONï¼‰ï¼Œ
            // æˆ–è€…æ˜¯ä¸€ä¸ªæ— æ•ˆçš„ JSON æ ¼å¼ï¼Œç›´æ¥è¿”å›åŸå§‹å€¼ã€‚
            return value;
        }
    };
})();
```

 **æ¨èå›ç­”ç»“æ„**ï¼š

> è¦è®¾ç½®æ”¯æŒè¿‡æœŸæ—¶é—´çš„ `localStorage`ï¼Œç”±äºåŸç”Ÿ `localStorage` æ²¡æœ‰è¿™ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡**å°è£…**å®ƒçš„ `setItem` å’Œ `getItem` æ–¹æ³•æ¥å®ç°ã€‚
>
> æ ¸å¿ƒæ€è·¯æ˜¯ï¼š
>
> 1. **å­˜å‚¨ï¼ˆ`setItem`ï¼‰ï¼š** ä¸åªå­˜å‚¨æ•°æ®ï¼Œè€Œæ˜¯å°†æ•°æ®å’Œä¸€ä¸ªè®¡ç®—å¥½çš„**è¿‡æœŸæ—¶é—´æˆ³**ï¼ˆè¿‡æœŸæ—¶é—´æˆ³æ˜¯è®¡ç®—å¾—åˆ°çš„ï¼Œé€šå¸¸æ˜¯ `å½“å‰æ—¶é—´` + `æœ‰æ•ˆæœŸï¼ˆæ¯«ç§’æ•°ï¼‰`ã€‚ï¼‰å°è£…æˆä¸€ä¸ªå¯¹è±¡ï¼Œç„¶åç”¨ `JSON.stringify()` å­˜è¿›å»ã€‚
> 2. **è¯»å–ï¼ˆ`getItem`ï¼‰ï¼š** å–å‡ºæ•°æ®æ—¶ï¼Œå…ˆæ£€æŸ¥å½“å‰æ—¶é—´ (`Date.now()`) æ˜¯å¦å¤§äºå­˜å‚¨çš„é‚£ä¸ªè¿‡æœŸæ—¶é—´æˆ³ã€‚
> 3. å¦‚æœ**å·²è¿‡æœŸ**ï¼Œå°±è°ƒç”¨ `removeItem` æ¸…é™¤è¯¥æ•°æ®ï¼Œå¹¶è¿”å› `null`ã€‚
> 4. å¦‚æœ**æœªè¿‡æœŸ**ï¼Œå°±è¿”å›å®é™…å­˜å‚¨çš„æ•°æ®ã€‚



### 6. cookie

**æ ¸å¿ƒçŸ¥è¯†**

ç”¨äº **å­˜å‚¨å°‘é‡æ–‡æœ¬æ•°æ®**ï¼ˆå¦‚ç™»å½•çŠ¶æ€ã€ç”¨æˆ·åå¥½ï¼‰ï¼Œä¸»è¦ç”¨äº **ä¼šè¯ç®¡ç†**ã€‚

------

#### 1.  æµè§ˆå™¨ä¸­ cookie æœ‰å“ªäº›å­—æ®µ

åœ¨æµè§ˆå™¨ä¸­ï¼Œä¸€ä¸ª Cookie ä¸»è¦ç”±ä»¥ä¸‹å­—æ®µç»„æˆï¼š

1. **name / value** Cookie çš„é”®å’Œå€¼ï¼Œæ˜¯æœ€åŸºæœ¬çš„å­—æ®µã€‚

2. **expires** æŒ‡å®š Cookie çš„è¿‡æœŸæ—¶é—´ï¼ˆç»å¯¹æ—¶é—´ï¼‰ã€‚åˆ°äº†æ—¶é—´åæµè§ˆå™¨ä¼šè‡ªåŠ¨åˆ é™¤ã€‚

3. **max-age** æŒ‡å®š Cookie çš„å­˜æ´»æ—¶é•¿ï¼ˆç›¸å¯¹æ—¶é—´ï¼Œå•ä½ç§’ï¼‰ã€‚`max-age` å’Œ `expires` äºŒé€‰ä¸€ï¼Œ`max-age` ä¼˜å…ˆçº§æ›´é«˜ã€‚

4. **domain** æŒ‡å®š Cookie å…è®¸å‘é€çš„åŸŸåèŒƒå›´ã€‚ ä¾‹å¦‚ï¼š`domain=.example.com` å¯åœ¨æ‰€æœ‰å­åŸŸå…±äº« Cookieã€‚

5. **path** æŒ‡å®š Cookie ç”Ÿæ•ˆçš„è·¯å¾„ã€‚ å¦‚ `path=/admin` åˆ™åªæœ‰è®¿é—® `/admin` ä¸‹çš„æ¥å£æ‰ä¼šå¸¦ä¸Š Cookieã€‚

6. **secure** è¡¨ç¤º Cookie ä»…åœ¨ HTTPS è¿æ¥ä¸­ä¼ è¾“ã€‚

7. **httpOnly** è¡¨ç¤º Cookie æ— æ³•é€šè¿‡ JavaScript çš„ `document.cookie` è®¿é—®ï¼Œæé«˜å®‰å…¨æ€§ã€‚

8. sameSite

   ç”¨äºé™åˆ¶è·¨ç«™è¯·æ±‚æ—¶ Cookie æ˜¯å¦èƒ½å‘é€ï¼Œé˜²æ­¢ CSRFã€‚å¸¸è§å–å€¼ï¼š

   - `Strict`ï¼šå®Œå…¨ç¦æ­¢è·¨ç«™å‘é€
   - `Lax`ï¼šéƒ¨åˆ†è·¨ç«™å…è®¸ï¼ˆå¦‚ Get å¯¼èˆªï¼‰
   - `None`ï¼šå…è®¸è·¨ç«™ï¼Œä½†å¿…é¡»æ­é… `Secure`

**ä¸€å¥è¯å¯ç”¨**

**Cookie çš„å­—æ®µåŒ…æ‹¬ï¼šnameã€valueã€expiresã€max-ageã€domainã€pathã€secureã€httpOnlyã€sameSiteã€‚å…¶ä¸­ secureã€httpOnlyã€sameSite æ˜¯å®‰å…¨ç›¸å…³å­—æ®µã€‚**



#### 2. å½“ cookie æ²¡æœ‰è®¾ç½® maxage æ—¶ï¼Œcookie ä¼šå­˜åœ¨å¤šä¹…

> å¦‚æœ Cookie æ²¡æœ‰è®¾ç½® `expires` æˆ– `max-age`ï¼Œå®ƒä¼šå˜æˆä¼šè¯ Cookieï¼Œåªåœ¨å½“å‰æµè§ˆå™¨**ä¼šè¯ä¸­æœ‰æ•ˆ**ï¼Œå…³é—­æµè§ˆå™¨åå°±ä¼šè¢«æ¸…é™¤ã€‚



#### 3. SameSite Cookie æœ‰å“ªäº›å€¼ï¼Œæ˜¯å¦‚ä½•é¢„é˜² CSRF æ”»å‡»çš„

**æ ¸å¿ƒçŸ¥è¯†**

**SameSite å±æ€§ç”¨äºé™åˆ¶ç¬¬ä¸‰æ–¹ç¯å¢ƒä¸‹ Cookie çš„å‘é€ï¼Œä¸»è¦æœ‰ä¸‰ä¸ªå€¼ï¼š**

**1 `SameSite=Strict`**

- æœ€ä¸¥æ ¼ã€‚
- **ä»»ä½•è·¨ç«™è¯·æ±‚éƒ½ä¸ä¼šæºå¸¦ Cookie**ï¼ˆåŒ…æ‹¬ç‚¹å‡»å¤–é“¾ï¼‰ã€‚
- é€‚ç”¨äºé«˜å®‰å…¨æ€§åœºæ™¯ï¼Œå¦‚é“¶è¡Œã€æ”¯ä»˜ï¼Œå‡ ä¹æœç» CSRFã€‚

**2 `SameSite=Lax`ï¼ˆæµè§ˆå™¨é»˜è®¤å€¼ï¼‰**

- å¤§éƒ¨åˆ†è·¨ç«™è¯·æ±‚ä¸å‘é€ Cookieã€‚
- **å…è®¸â€œå®‰å…¨çš„ GET è·¨ç«™è¯·æ±‚â€æºå¸¦ Cookie**ï¼Œä¾‹å¦‚ï¼š
  - ç‚¹å‡»é“¾æ¥è·³è½¬ã€æ‰“å¼€æ–°é¡µé¢
- ä¸èƒ½ç”¨äºè·¨ç«™ POSTã€iframeã€fetchã€‚

**3 `SameSite=None; Secure`**

- **å¿…é¡»é…åˆ `Secure` ä¸€èµ·ä½¿ç”¨**ï¼ˆå¦åˆ™è¢«æµè§ˆå™¨æ‹’ç»ï¼‰ã€‚
- å…è®¸ Cookie åœ¨æ‰€æœ‰ç¬¬ä¸‰æ–¹åœºæ™¯ä¸­æºå¸¦ã€‚
- ç”¨äºè·¨åŸŸç™»å½•ã€ç¬¬ä¸‰æ–¹ SDKã€CDN èµ„æºç­‰ã€‚



**æ¨èå›ç­”**ï¼š

> **SameSite Cookie ä¸»è¦æœ‰ä¸‰ä¸ªå€¼ï¼š**
>
> 1. **Strict**ï¼šæœ€ä¸¥æ ¼ï¼Œæ‰€æœ‰è·¨ç«™è¯·æ±‚éƒ½ä¸ä¼šæºå¸¦ Cookieï¼Œå¯ä»¥å®ç°æœ€å¼ºçš„ CSRF é˜²æŠ¤ã€‚
> 2. **Lax**ï¼šæµè§ˆå™¨é»˜è®¤å€¼ï¼Œåªæœ‰å¯¼èˆªåˆ°ç¬¬ä¸‰æ–¹ç½‘ç«™çš„ Get é“¾æ¥ä¼šå‘é€ Cookieï¼Œè·¨åŸŸçš„å›¾ç‰‡ã€iframeã€formè¡¨å•éƒ½ä¸ä¼šå‘é€ Cookieï¼Œå¯ä»¥é˜»æ­¢å¤§å¤šæ•° CSRF æ”»å‡»ã€‚
> 3. **None**ï¼šå¿…é¡»ä¸ Secure é…åˆä½¿ç”¨ï¼Œå³åœ¨ https ä¸‹å‘é€ã€‚ä»»ä½•æƒ…å†µä¸‹éƒ½ä¼šå‘ç¬¬ä¸‰æ–¹ç½‘ç«™è¯·æ±‚å‘é€ Cookieï¼Œå¸¸ç”¨äºè·¨åŸŸç™»å½•æˆ–ç¬¬ä¸‰æ–¹åº”ç”¨ã€‚
>
> **SameSite èƒ½é¢„é˜² CSRF çš„åŸå› æ˜¯ï¼š**
>  CSRF ä¾èµ–æµè§ˆå™¨åœ¨è·¨ç«™è¯·æ±‚ä¸­â€œè‡ªåŠ¨å¸¦ä¸Š Cookieâ€ã€‚
>  è€Œ SameSite ä¼šé™åˆ¶ Cookie åœ¨è·¨ç«™ç¯å¢ƒä¸‹å‘é€ï¼Œä»æºå¤´é˜»æ–­äº†æ”»å‡»è€…åˆ©ç”¨ç”¨æˆ· Cookie è¿›è¡Œæ¶æ„è¯·æ±‚çš„å¯èƒ½æ€§ã€‚



#### 4. Cookie å¢åˆ æ”¹æŸ¥

**é¢˜ç›®ï¼šå¦‚ä½•è®¾ç½®ä¸€ä¸ªCookieï¼Ÿ**

æ ¸å¿ƒçŸ¥è¯†

**1. é€šè¿‡ `document.cookie` è®¾ç½®ï¼ˆæµè§ˆå™¨ç«¯æœ€å¸¸è§ï¼‰**
 `document.cookie = "key=value; expires=...; max-age=...; path=/; domain=...; secure; samesite=..."`

**2.ä¹Ÿå¯ä»¥ä½¿ç”¨æ–°çš„API**

```javascript
await cookieStore.set({
  name: "token",
  value: "abc123",
  expires: Date.now() + 3600 * 1000,
  path: "/",
  sameSite: "Lax",
  secure: true
});
```

**æ¨èå›ç­”ï¼š**

> åœ¨æµè§ˆå™¨ç«¯è®¾ç½® Cookie ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼šä¼ ç»Ÿæ–¹å¼æ˜¯ä½¿ç”¨ `document.cookie` å†™ä¸€æ®µ `key=value` çš„å­—ç¬¦ä¸²ï¼ŒåŒæ—¶å¸¦ä¸Š `expires`ã€`max-age`ã€`path`ã€`secure`ã€`SameSite` ç­‰å±æ€§ã€‚
>
> åœ¨ç°ä»£æµè§ˆå™¨ä¸­ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ **Cookie Store API** çš„ `cookieStore.set()`ï¼Œå®ƒæ˜¯å¼‚æ­¥çš„ï¼Œå‚æ•°æ˜¯å¯¹è±¡å½¢å¼ï¼Œæ›´å®‰å…¨ã€‚



**é¢˜ç›®ï¼š å¦‚ä½•åˆ é™¤ä¸€ä¸ªCookieï¼Ÿ**

æ ¸å¿ƒçŸ¥è¯†

å‰ç«¯ **æ— æ³•çœŸæ­£åˆ é™¤ Cookie**ï¼Œåªèƒ½é€šè¿‡ï¼š
 **è®¾ç½®ç›¸åŒ keyã€ç›¸åŒ pathã€ç›¸åŒ domainï¼Œå¹¶æŠŠè¿‡æœŸæ—¶é—´è®¾ä¸ºè¿‡å»æ—¶é—´ï¼Œä»è€Œè®©æµè§ˆå™¨è‡ªåŠ¨æ¸…é™¤ã€‚**

**æ¨èå›ç­”ï¼š**

> åˆ é™¤ Cookie çš„æœ¬è´¨æ˜¯è®©æµè§ˆå™¨æŠŠå®ƒè¿‡æœŸæ‰ï¼šè¦ä¹ˆç”¨ `max-age=-1ï¼Œè¦ä¹ˆç”¨ ` expires ` è®¾ç½®ä¸ºè¿‡å»æ—¶é—´ã€‚å¦‚æœç”¨ Cookie Store APIï¼Œåˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨ `cookieStore.delete(name)`ï¼Œä½† pathã€domain å¿…é¡»ä¸åŸæ¥ä¸€è‡´ã€‚



> **é¡ºä¾¿è¡¥å……ä¸€ä¸‹ï¼ŒCookie Store API æ¯”ä¼ ç»Ÿçš„ `document.cookie` æ›´ç°ä»£ã€å¯è¯»æ€§æ›´å¥½ï¼Œä¹Ÿæ”¯æŒå¼‚æ­¥æ“ä½œï¼Œä½†ç›®å‰ Safari è¿˜æ²¡æœ‰å®Œå…¨æ”¯æŒï¼Œæ‰€ä»¥é¡¹ç›®ä¸­ä¸€èˆ¬æ˜¯ä¸¤è€…ç»“åˆä½¿ç”¨ã€‚**
